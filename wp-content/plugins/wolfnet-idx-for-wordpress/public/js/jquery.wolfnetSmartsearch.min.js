!function(a){var b="wolfnetSmartSearch",c=b+".state",d={fields:[],minLength:3,fieldMap:{},searchField:null,suggestionHoverClass:"wnt-hover"},e={enabled:!1,markets:null,allMarkets:null,currentMarket:null,labelLookup:null,actionLookup:null,submitted:!1},f=function(){var a=this.closest("form");!isNaN(a.width())&&a.width()>0&&a.width()<=500?a.addClass("wnt-smartsearch-narrow"):a.removeClass("wnt-smartsearch-narrow")},g={init:function(b){return b.ajaxUrl?b.ajaxAction?this.each(function(){var f=a(this),h=a.extend(!0,{},d,b);if("undefined"==typeof b.markets?e.markets="":e.markets=b.markets,e.markets.length)for(e.enabled=!0,e.labelLookup={},e.actionLookup={},e.allMarkets=[],i=0;i<e.markets.length;i++)e.labelLookup[e.markets[i].datasource_name]=e.markets[i].market_label,e.actionLookup[e.markets[i].datasource_name]=e.markets[i].site_url,e.allMarkets.push(e.markets[i].datasource_name);0===h.fields.length&&h.fields.push(f.attr("name")),f.data(c,h),g.createInputControl(f),g.createSuggestionControl(f),g.defineEvents(f),g.refreshExistingValues(f,null,!1),g.submitHandler(f)}):(a.error('The "ajaxAction" option must be included when initializing the plugin.'),this):(a.error('The "ajaxUrl" option must be included when initializing the plugin.'),this)},disable:function(){return this.each(function(){var b=a(this),d=b.data(c),e=d.listContainer;b.prop("disabled",!0),e.hide()})},enable:function(){return this.each(function(){var b=a(this),d=b.data(c),e=d.listContainer;b.prop("disabled",!1),e.show()})},getContainer:function(){var b=a();return this.each(function(){var d=a(this),e=d.data(c),f=e.listContainer;b=b.add(f)}),b},createInputControl:function(b){var d=a(b[0].form),e=b.data(c),f=a("<input>").attr({autocomplete:"off",name:"q"==b.attr("name")?"q":"",placeholder:b.attr("placeholder"),type:"text"}).css({outline:"none",minWidth:"5em",width:"100%"}).val(b.val()),h=a("<span>").addClass("wnt-smart-search-input").css({display:"inline-block",width:"100%"}).append(f),i=a("<span>").addClass(b.attr("class")).css({"text-align":"left"}).append(h).click(function(){f.focus()}).resize(function(){g.resizeSuggestionsList(b)}).insertBefore(b);b.is(":focus")&&f.focus(),b.hide(),b.prependTo(d),"q"==b.attr("name")&&(b.removeAttr("name"),f.val(b.val())),e.searchInput=f,e.listContainer=i,b.data(c,e)},createSuggestionControl:function(b){var d=b.data(c),e=d.listContainer;d.searchInput;d.searchingClass="wnt-message-searching"+d.componentId;var f=a("<div>").addClass(d.searchingClass).text("Searching ..."),g=a("<div>").addClass("wnt-suggestions").css({position:"absolute",left:0,width:e.outerWidth()+1,backgroundColor:"white",zIndex:9e6}).hide().append(f).appendTo(a(".smart-menu"+d.componentId));d.suggestionContainer=g,b.data(c,d)},updateSuggestionsList:function(b,d){var f=b.data(c),h=(f.listContainer,f.suggestionContainer);f.searchInput,f.suggestionHoverClass;if(g.resizeSuggestionsList(b),g.resetSuggestionsList(b),d.length>0){for(var i in d){var j=a("<span>").text(d[i].value).addClass("wolfnet-suggestion-label");if(e.enabled&&null==e.currentMarket&&e.markets.length>1)var k=d[i].market,l=" in "+e.labelLookup[k];else{var k=null;l=""}var m=a("<span>").text(d[i].label+l).addClass("wolfnet-suggestion-field"),n=a("<span>").css("clear","both");a("<div>").addClass("wnt-suggestion").data("value",d[i].value).data("field",d[i].field).data("datasource",k).append(j).append(m).append(n).appendTo(h).on("click",g.suggestionClick).on("mouseover",{$smartSearch:b},g.suggestionMouseover).on("wntSelect",{$smartSearch:b},g.suggestionOnWntSearch)}g.showSuggestionsList(b)}else g.resetSuggestionsList(b)},submitHandler:function(b){var c=a(b[0].form);c.submit(function(a){return!e.enabled||(1==e.markets.length?c.attr("action",e.actionLookup[e.markets[0].datasource_name]):c.attr("action",e.actionLookup[e.currentMarket]),!0)})},defineEvents:function(b){var d=b.data(c),e=d.searchInput,h=(d.listContainer,d.suggestionContainer),i=a(b[0].form);a(window).on("resize",function(){f.call(b)}),f.call(b),b.on("wntFocus",function(a){e.focus()});for(var j=0,k=d.fields.length;j<k;j++){var l=i.find('input[name="'+d.fields[j]+'"]');l.on("change",{$smartSearch:b},g.fieldChange)}e.on("keydown",{$smartSearch:b},g.searchInputKeydown).on("keyup",{$smartSearch:b},g.searchInputKeyup).on("blur",{$smartSearch:b},g.searchInputBlur).on("focus",{$smartSearch:b},g.searchInputFocus),h.on("mouseover",{$smartSearch:b},g.suggestionContainerMouseover).on("mouseout",{$smartSearch:b},g.suggestionContainerMouseout),i.on("reset",function(){g.removeAllValues(b)})},getFieldNameFromFieldMap:function(a,b){var d=a.data(c).fieldMap||{};return d[b]||b},suggestionsVisibleWithResults:function(a){var b=a.data(c).suggestionContainer,d=b.is(":not(:hidden)"),e=b.find(".wnt-suggestion").length>0;return d&&e},widestElementWidth:function(b){var c=0;return b.each(function(){var b=a(this).outerWidth();c=b>c?b:c}),c},input:function(b,d){var f=b.data(c),h=(f.suggestionContainer,a(b[0].form)),i=h.find(".wnt-ss-value").length;if(f.xhr&&f.xhr.abort(),d.length>=f.minLength){var j={term:d};f.searchField&&(j.field=f.searchField),e.enabled&&(1==e.markets.length?j.marketList='["'+e.markets[0].datasource_name+'"]':e.markets.length>1&&0==i?(e.currentMarket=null,j.marketList=JSON.stringify(e.allMarkets)):null!=e.currentMarket&&(j.marketList='["'+e.currentMarket+'"]')),f.xhr=a.ajax({url:f.ajaxUrl,data:{action:f.ajaxAction,data:j},dataType:"jsonp",context:b,beforeSend:function(){g.showSearchingMessage(this)}}).done(function(a){g.updateSuggestionsList(this,a)}).always(function(a){g.hideSearchingMessage(this)}),b.data(c,f)}else g.resetSuggestionsList(b)},addValue:function(b,d,f,h,i){h="undefined"!=typeof h&&h;var j=b.data(c),k=(j.listContainer,a(b[0].form)),l=j.searchInput,m=!1;null==e.currentMarket&&(e.currentMarket=i),f=g.getFieldNameFromFieldMap(b,f);var n=k.find('input[name="'+f+'"]');0===n.length&&(n=a("<input>").attr({name:f,type:"hidden"}).appendTo(k));var o=n.val().split(",");a.inArray(d,o)==-1&&(m=!0,o.push(d)),n.val(o.join(",").replace(/(^,)|(,$)/g,""));var p=a("<span>").data("value",d).data("field",f).addClass("wnt-ss-value").css("display","inline-block").on("wntRemove",function(){var c=a(this),d=c.data("value"),e=c.data("field");g.removeValue(b,d,e)});a("<span>").text(d).appendTo(p),a("<span>").addClass("wnt-close-btn").addClass("icon").addClass("icon-close").html("<span>x</span>").appendTo(p).click(function(){var b=a(this).parent();b.trigger("wntRemove")});if(p.insertBefore(l.parent()),g.resizeSuggestionsList(b),!h&&(b.trigger("wntSmartSearchUpdated"),m)){var q=jQuery.Event("change");q.relatedTarget=b[0],n.trigger(q)}},removeValue:function(b,d,e){var f=b.data(c),h=f.listContainer,i=a(b[0].form),j=!1;e=g.getFieldNameFromFieldMap(b,e)||e;var k=i.find('input[name="'+e+'"]');if(0!==k.length){var l=a.grep(k.val().split(","),function(a){return j=a==d||j,a!=d});if(k.val(l.join(",").replace(/(^,)|(,$)/g,"")),h.children(".wnt-ss-value").each(function(){var b=a(this),c=b.data("value")||"",f=b.data("field")||"";c==d&&e&&f==e&&b.remove()}),g.resizeSuggestionsList(b),b.trigger("wntSmartSearchUpdated"),j){var m=jQuery.Event("change");m.relatedTarget=b[0],k.trigger(m)}}},removeAllValues:function(b){var d=b.data(c),e=d.listContainer;e.children(".wnt-ss-value").each(function(){var c=a(this),d=c.data("value")||"",e=c.data("field")||"";""!==d&&""!==e&&g.removeValue(b,d,e)})},removeMostRecentValue:function(b){var d=b.data(c).listContainer||a("<span>");d.children(".wnt-ss-value:last").trigger("wntRemove")},showSuggestionsList:function(b){var d=b.data(c).suggestionContainer.show(),e=g.widestElementWidth(d.find(".wolfnet-suggestion-field")),f=d.find(".wnt-suggestion:first").width()-e;d.find(".wolfnet-suggestion-label").each(function(){var b=a(this);b.width()>f-10&&b.width(f-10)})},hideSuggestionsList:function(a){a.data(c).suggestionContainer.hide()},resetSuggestionsList:function(a){var b=a.data(c),d=b.suggestionContainer,e=d.children(".wnt-suggestion");g.hideSuggestionsList(a),e.remove()},moveSuggestionSelectUp:function(a){var b=a.data(c),d=b.suggestionContainer,e=d.find(".wnt-suggestion.wnt-hover"),f=e.prev(".wnt-suggestion");f.length&&(f.addClass("wnt-hover"),e.removeClass("wnt-hover"))},moveSuggestionSelectDown:function(a){var b=a.data(c),d=b.suggestionContainer,e=d.find(".wnt-suggestion.wnt-hover"),f=e.next(".wnt-suggestion");f.length&&(f.addClass("wnt-hover"),e.removeClass("wnt-hover"))},selectHighlightedSuggestion:function(a){var b=a.data(c),d=b.suggestionContainer,e=d.find(".wnt-suggestion.wnt-hover");e.trigger("wntSelect")},showSearchingMessage:function(a){var b=a.data(c);b.suggestionContainer.children("."+b.searchingClass).show(),g.showSuggestionsList(a)},hideSearchingMessage:function(a){var b=a.data(c);b.suggestionContainer.children("."+b.searchingClass).hide()},refreshExistingValues:function(b,d,e){e="undefined"!=typeof e&&e;for(var f=a(b[0].form),h=b.data(c),i=h.listContainer,j={},k=[],l=[],m=0,n=h.fields.length;m<n;m++){var o=f.find('input[name="'+h.fields[m]+'"]');if(0!==o.length){var p=a.trim(o.val()).split(",");j[h.fields[m]]=p;for(var q=0,r=p.length;q<r;q++){var s=h.fields[m],t=p[q];""!==a.trim(p[q])&&k.push({field:s,value:t})}}}i.find("span.wnt-ss-value").each(function(){for(var b=a(this),c={field:b.data("field"),value:b.data("value")},d=0,e=[],f=k.length;d<f;d++){var g=k[d];g.field==c.field&&g.value==c.value||e.push(g)}k=e,j[c.field]&&a.inArray(c.value,j[c.field])!=-1||l.push(c)});for(var u=0,v=k.length;u<v;u++)g.addValue(b,k[u].value,k[u].field,e);for(var w=0,x=l.length;w<x;w++)g.removeValue(b,l[w].value,l[w].field)},resizeSuggestionsList:function(a){var b=a.data(c),d=b.listContainer,e=b.suggestionContainer;d.offset();g.toggleInputPlaceholder(a);var f=0,h=d.outerWidth()+parseInt(d.css("margin-left"))+parseInt(d.css("margin-right"));e.css({top:top,left:f,width:h})},toggleInputPlaceholder:function(b){var d=b.data(c),e=d.searchInput,f=d.listContainer,g=f.children(".wnt-ss-value").children().length;0===g?(a(".wnt-smart-search-input").css("width","100%"),e.attr("placeholder",b.attr("placeholder")).css("width","100%")):(a(".wnt-smart-search-input").css("width",0),e.attr("placeholder","").css("width","auto"))},searchInputKeydown:function(b){var c=a(this),d=b.data.$smartSearch;switch(b.keyCode){case 9:case 16:case 17:case 18:case 19:case 20:case 33:case 34:case 35:case 36:case 37:case 39:case 45:case 91:case 92:case 93:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 144:case 145:case 186:case 187:case 188:case 189:case 192:return!0;case 13:if(""!==c.val()&&g.suggestionsVisibleWithResults(d))return b.preventDefault(),g.selectHighlightedSuggestion(d),!1;break;case 8:""===c.val()&&g.removeMostRecentValue(d);break;case 40:case 38:return b.preventDefault(),!1}},searchInputKeyup:function(b){var c=a(this),d=b.data.$smartSearch,e=(c.parent().parent(),a(d[0].form));switch("q"==d.attr("name")&&d.trigger(b),b.keyCode){case 9:case 16:case 17:case 18:case 19:case 20:case 33:case 34:case 35:case 36:case 37:case 39:case 45:case 91:case 92:case 93:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 144:case 145:case 186:case 187:case 188:case 189:case 192:return!0;case 27:return g.hideSuggestionsList(d),!1;case 13:return g.suggestionsVisibleWithResults(d)?(b.preventDefault(),!1):(e.submit(),!0);case 40:return b.preventDefault(),g.moveSuggestionSelectDown(d),!1;case 38:return b.preventDefault(),g.moveSuggestionSelectUp(d),!1;case 8:return g.input(d,c.val()),g.toggleInputPlaceholder(d),!0;default:g.input(d,c.val())}},searchInputBlur:function(a){var b=a.data.$smartSearch,d=b.data(c),e=d.listContainer;e.removeClass("focus"),d.overSuggestions||g.hideSuggestionsList(b)},searchInputFocus:function(a){var b=a.data.$smartSearch,d=b.data(c),e=d.listContainer;e.addClass("focus"),g.resetSuggestionsList(b)},suggestionContainerMouseover:function(a){var b=a.data.$smartSearch,d=b.data(c);d.overSuggestions=!0,b.data(c,d)},suggestionContainerMouseout:function(a){var b=a.data.$smartSearch,d=b.data(c),e=d.searchInput;d.overSuggestions=!1,b.data(c,d),e.is(":focus")||g.hideSuggestionsList(b)},suggestionClick:function(b){var c=a(this);c.trigger("wntSelect")},suggestionMouseover:function(b){var d=a(this),e=b.data.$smartSearch,f=e.data(c).suggestionHoverClass;d.addClass(f),d.siblings("."+f).removeClass(f)},suggestionOnWntSearch:function(b){var d=a(this),e=b.data.$smartSearch,f=e.data(c),h=f.searchInput,i=d.data("value"),j=d.data("field"),k=d.data("datasource");h.val(""),g.resetSuggestionsList(e),g.addValue(e,i,j,!1,k),e.trigger("wntFocus")},fieldChange:function(a){var b=a.data.$smartSearch;a.relatedTarget!=b[0]&&g.refreshExistingValues(b,a)}};a.fn[b]=function(b){return g[b]?g[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery."+pluginName):g.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=jquery.wolfnetSmartsearch.min.js.map